# 4.5 개발 환경의 보안과 유지보수

## 4.5.1 웹을 개발하는 아키텍처 품질 속성 소개

아키텍처 품질은 기능성, 유지보수성, 성능, 보안 등을 결정하는 다양한 특성을 포함

### 이해 용이성(Understandability)

아키텍처는 모든 개발자가 쉡게 이해해야함

명확한 문서화, 일관된 코딩 표준, 구조화된 코드 베이스가 필요

### 수정 용이성(Modifiability)

기능을 추가하거나 변경에 대한 용이성을 말함

단일 책임 원칙과 중복 배제 원칙을 따르면 수정 용이성이 높아짐

### 성능(Performance)

리소스 사용 효율성과 사용자 입력에 대한 응답 시간을 포함

성능 최적화가 잘 되어야 사용자 경험이 나아짐

### 보안(Security)

안전한 아키텍처는 사용자 데이터를 보호하고 무단 액세스를 방지해 신뢰도를 높임

### 확장성(Scalability)

사용자 부하뿐만 아니라 데이터 볼륨과 작업 복잡성의 증가에 따라 성장하는 능력

로드 밸런싱, DB 최적화, 리소스 최적화는 앱의 확장성을 향상시킴

### 신뢰성(Reliability) 및 가용성(Availability)

신뢰성은 예상대로의 동작을 보장하는 것을 의미,<br>
가용성은 필요할 때 앱에 접근하게 하는 것을 의미

자동테스트와 시스템 모니터링 및 대체 가능한 시스템 설정은 이런 속성을 높여줌

## 4.5.2 Next.js에서 환경 변수를 통한 보안 강화

환경 변수의 안전한 관리는 매우 중요함!!<br>
보통 환경 변수를 통해 DB의 접속 정보다 API 키를 관리하기 때문

Next.js 에서는 .env.local 파일을 통해 환경변수를 안전하게 로드함

```
# .env.local 예시
DB_HOST=localhost
DB_USER=myuser
DB_PASS=mypassword
NEXT_PUBLIC_API_URL=https://api.example.com
```

.env 파일은 프로젝트 루트에 위치해야하고 <br>
버전 관리 시스템에 포함되어서는 안됨

`process.env`를 통해 사용 가능

```js
// 안전함
const dbHost = process.env.DB_HOST;
const dbUser = process.env.DB_USER;
const dbPass = process.env.DB_PASS;
// 안전하지 않음 - 브라우저에 노출
const apiUrl = process.env.NEXT_PUBLIC_API_URL;
```

`NEXT_PUBLIC_`으로 시작하는 변수는 클라이언트 컴포넌트에서 사용하는 변수임<br>
그래서 사용자 브라우저에 노출됨

`NEXT_PUBLIC_` 접두사가 없는 환경변수는 서버 컴포넌트에서만 접근 가능

#### Next.js 는 환경별 .env 파일을 허용함

- .env.development
- .env.production 등

민감한 정보를 코드 베이스에 하드코딩 하지 마세요.

### 버전 관리 시 주의사항

.env.local 파일은 버전 관리에서 제외하는 대신<br>
.env.excample 처럼 템플릿 파일을 사용해 필요한 환경변수 예시를 제공

.gitignore 에 .env\* 추가해 .env 파일을 무시하고 .env.example 만 포함

### 배포와 테스트 환경에서의 환경 변수

클라이언트 측에 민감한 데이터가 노출되지 않도록 주의하며<br>
필요하면 애플리케이션에서 환경 변수의 변ㄴ경사항을 실시간으롤 반영하도록 설정

`@next/env` 패키지의 `loadEnvConfig` 함수를 사용하면<br>
테스트 환경에서도 Next.js에서 환경 변수를 로드하는 것과 동일한 방식으로 환경 변수를 설정함

이를 통해 개발, 테스트, 프로덕션 환경 간의 설정 일관성을 유지

```js
import { loadEnvConfig } from "@next/env";
export default async () => {
  const projectDir = process.cwd();
  loadEnvConfig(projectDir);
};
```

### 환경 변수 로드 순서

이 순서를 통해 환경별 구성이 기본값을 덮어쓰도록 보장됨

1. process.env
2. .env.$(NODE_ENV).local
3. .env.local (NODE_ENV가 test 일 때는 확인하지 않음)
4. .env.$(NODE_ENV)
5. .env
